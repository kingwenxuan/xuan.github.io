<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>2048小游戏</title>
  <style>
    body {
      background: #111;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: Arial, sans-serif;
      color: white;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(4, 100px);
      grid-template-rows: repeat(4, 100px);
      gap: 10px;
      background: #333;
      padding: 10px;
      border-radius: 10px;
    }
    .tile {
      width: 100px;
      height: 100px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      font-weight: bold;
      border-radius: 5px;
      background: #444;
      color: white;
    }
    .back-btn {
      margin-top: 20px;
      padding: 10px 20px;
      background: #0ff;
      color: #111;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: 0.3s;
    }
    .back-btn:hover {
      background: #0cc;
    }
  </style>
</head>
<body>
  <div id="board"></div>
  <button class="back-btn" onclick="window.location.href='../index.html'">返回主页</button>
  <script>
    const board = document.getElementById("board");
    let grid = [];

    function init() {
      grid = Array(4).fill().map(() => Array(4).fill(0));
      addNumber();
      addNumber();
      draw();
    }

    function addNumber() {
      let empty = [];
      for (let r = 0; r < 4; r++) {
        for (let c = 0; c < 4; c++) {
          if (grid[r][c] === 0) empty.push({ r, c });
        }
      }
      if (empty.length === 0) return;
      let { r, c } = empty[Math.floor(Math.random() * empty.length)];
      grid[r][c] = Math.random() > 0.5 ? 2 : 4;
    }

    function draw() {
      board.innerHTML = "";
      for (let r = 0; r < 4; r++) {
        for (let c = 0; c < 4; c++) {
          let tile = document.createElement("div");
          tile.className = "tile";
          let value = grid[r][c];
          tile.textContent = value === 0 ? "" : value;
          tile.style.background = value === 0 ? "#444" : `hsl(${Math.log2(value) * 30}, 70%, 50%)`;
          board.appendChild(tile);
        }
      }
    }

    function slide(row) {
      row = row.filter(val => val);
      for (let i = 0; i < row.length - 1; i++) {
        if (row[i] === row[i + 1]) {
          row[i] *= 2;
          row[i + 1] = 0;
        }
      }
      row = row.filter(val => val);
      while (row.length < 4) row.push(0);
      return row;
    }

    function rotate() {
      let newGrid = Array(4).fill().map(() => Array(4).fill(0));
      for (let r = 0; r < 4; r++) {
        for (let c = 0; c < 4; c++) {
          newGrid[c][3 - r] = grid[r][c];
        }
      }
      grid = newGrid;
    }

    function moveLeft() {
      for (let r = 0; r < 4; r++) {
        grid[r] = slide(grid[r]);
      }
    }

    function keyPress(e) {
      let prev = JSON.stringify(grid);
      if (e.key === "ArrowLeft") moveLeft();
      else if (e.key === "ArrowRight") { rotate(); rotate(); moveLeft(); rotate(); rotate(); }
      else if (e.key === "ArrowUp") { rotate(); rotate(); rotate(); moveLeft(); rotate(); }
      else if (e.key === "ArrowDown") { rotate(); moveLeft(); rotate(); rotate(); rotate(); }
      if (JSON.stringify(grid) !== prev) addNumber();
      draw();
    }

    document.addEventListener("keydown", keyPress);
    init();
  </script>
</body>
</html>
